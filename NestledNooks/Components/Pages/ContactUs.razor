@page "/contact"
@using NestledNooks.Models
@using NestledNooks.Services
@inject IEmailService EmailService

<div class="login-wrapper">
	<div class="login-card">

		<h2 class="login-title">Contact Us</h2>
		<p class="login-subtitle">
			Have a question or need help? Send us a message and we’ll get back to you.
		</p>

		<EditForm Model="@contactModel" OnValidSubmit="SendMessage">
			<DataAnnotationsValidator />

			<div class="form-group">
				<label for="name">Your Name</label>
				<InputText id="name"
						   class="form-control"
						   @bind-Value="contactModel.Name" />
				<ValidationMessage For="() => contactModel.Name" class="text-danger" />
			</div>

			<div class="form-group">
				<label for="email">Your Email</label>
				<InputText id="email"
						   type="email"
						   class="form-control"
						   @bind-Value="contactModel.Email" />
				<ValidationMessage For="() => contactModel.Email" class="text-danger" />
			</div>

			<div class="form-group">
				<label for="message">Your Message</label>
				<InputTextArea id="message"
							   rows="5"
							   class="form-control"
							   @bind-Value="contactModel.Message" />
				<ValidationMessage For="() => contactModel.Message" class="text-danger" />
			</div>

			<button type="submit"
					class="btn btn-login"
					disabled="@isSending">
				@(isSending ? "Sending..." : "Send Message")
			</button>

			@if (!string.IsNullOrEmpty(statusMessage))
			{
				<p class="login-subtitle mt-3">@statusMessage</p>
			}
		</EditForm>

	</div>
</div>

@code {
	private ContactFormModel contactModel = new();
	private bool isSending = false;
	private string statusMessage = string.Empty;

	private async Task SendMessage()
	{
		isSending = true;
		statusMessage = string.Empty;

		try
		{
			await EmailService.SendContactEmail(
				contactModel.Name,
				contactModel.Email,
				contactModel.Message
			);

			statusMessage = "Thanks! Your message has been sent.";
			contactModel = new();
		}
		catch
		{
			statusMessage = "Something went wrong. Please try again later.";
		}
		finally
		{
			isSending = false;
		}
	}
}
